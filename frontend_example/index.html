<html>
	<head>
		<title> FrontEnd Example </title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf8">
		<script type="text/javascript">
			
			function createUrlFromObj(obj) {
				var str = "";
				for (k in obj) {
					if (str.length > 0)
						str += "&";
					str += encodeURIComponent(k) + "=" + encodeURIComponent(obj[k]);
				}
				return str;
			}
			
			var xmlhttp = null;
			
			function send_request_post(page, url, callbackf) {
				
				if (window.XMLHttpRequest && xmlhttp == null) {
					// code for IE7+, Firefox, Chrome, Opera, Safari
					xmlhttp = new XMLHttpRequest();
				};
				xmlhttp.onreadystatechange=function() {
					if (xmlhttp.readyState==4 && xmlhttp.status==200) {
						if(xmlhttp.responseText == "")
							alert("error");
						else
						{
							var obj = JSON.parse(xmlhttp.responseText);
							callbackf(obj);
						}
					}
				}
				xmlhttp.open("POST", page, true);
				xmlhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
				xmlhttp.send(url);
			};

			var base_url = "http://localhost/fhq/";
			var token = '';
			function sign_in() {
				document.getElementById('error').innerHTML = "";
				var params = {};
				params.email = document.getElementById('email').value;
				params.password = document.getElementById('password').value;
				params.client = "FrontEnd Example";
				send_request_post(
					base_url + 'api/auth/sign_in.php',
					createUrlFromObj(params),
					function (obj) {
						if (obj.result == "ok") {
							document.getElementById('login_result').innerHTML = "Authorized. Token: " + obj.token;
							token = obj.token;
						} else {
							document.getElementById('error').innerHTML = obj.error.message;
							document.getElementById('login_result').innerHTML = "Fail.";
						}
					}
				);
			}
			
			function choose_game() {
				var params = {};
				params.id = 7;
				document.getElementById('error').innerHTML = "";
				send_request_post(
					base_url + 'api/games/choose.php',
					createUrlFromObj(params),
					function (obj) {
						if (obj.result == "ok") {
							document.getElementById('choose_game_result').innerHTML = "Choosed";
						} else {
							document.getElementById('error').innerHTML = obj.error.message;
							document.getElementById('choose_game_result').innerHTML = "Fail";
						}
					}
				);
			}
		</script>
	</head>
	<body>
		<div id="error"></div>
		<div id="login_form">
			<input type="text" id="email" value=""/><br>
			<input type="password" id="password" value=""/><br>
			<a href="javascript:void(0);" onclick="sign_in();">Sign in</a>
			<div id="login_result"></div>
		</div>
		<div id="choose_form">
			TODO: work from access-token
			<a href="javascript:void(0);" onclick="choose_game();">Choose Game</a>
			<div id="choose_game_result"></div>
		</div>
		
	</body>
</html>
